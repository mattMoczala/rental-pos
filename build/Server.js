"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Server=void 0;var express=require("express"),https=require("https"),fs=require("fs"),logger=require("morgan"),cookieParser=require("cookie-parser"),createError=require("http-errors"),path=require("path"),session=require("express-session"),logger_1=require("./logger"),passport=require("passport"),bodyParser=require("body-parser"),ConnectionConstructor_1=require("./db/ConnectionConstructor"),index=require("./routes/index"),Server=function(){function e(e,s){this.app=express(),this.port=process.env.PORT||443,this.dbHostname=e,this.dbAuth=s,this.dbAuth.useNewUrlParser=!0,this.dbConnection=new ConnectionConstructor_1.default(this.dbAuth,this.dbHostname)}return e.prototype._setUpExpressConfig=function(){this.app.set("view engine","jade"),this.app.set("views",path.join(__dirname+"/views")),this.app.use(bodyParser.json({limit:"50mb"})),this.app.use(bodyParser.urlencoded({limit:"50mb",extended:!0})),this.app.use(logger("dev")),this.app.use(express.json()),this.app.use(express.urlencoded({extended:!1})),this.app.use(cookieParser()),this.app.use(express.static(path.join(__dirname,"static"))),this.app.use(session({secret:"sessionSecret",cookie:{maxAge:54e6},saveUninitialized:!0,resave:!0})),this.app.use(express.json()),this.app.use(passport.initialize()),this.app.use(passport.session()),this.app.use(require("connect-flash")()),this.app.use("/",index.router),this.app.use("/robots.txt",function(e,s,r){s.type("text/plain"),s.send("User-agent: *\nDisallow: /img")}),this.app.use(function(e,s,r){r(createError(404))}),this.app.use(function(e,s,r,t){r.locals.message=e.message,r.locals.error=e,r.status(e.status||500),r.render("error",{err:e})})},e.prototype.startWebServer=function(){var e=this;this._setUpExpressConfig(),this.server=https.createServer({cert:fs.readFileSync(__dirname+"/keys/https/certificate.pem"),key:fs.readFileSync(__dirname+"/keys/https/key.pem")},this.app),this.server.listen(this.port,function(){(0,logger_1.logAction)("server started on port ".concat(e.port,"..."),"info")})},e}();exports.Server=Server;